{% extends "base.html" %} {% block atas7 %} Form Atha {% endblock %} {% block
tengah7 %}
<h3 class="text-info mb-3">Form Data Barang</h3>

<!-- FORM TAMBAH -->
<form method="POST" id="userForm" class="mb-4">
  <input
    type="text"
    name="nama"
    placeholder="Nama Barang"
    class="form-control mb-2"
    required
  />
  <input
    type="text"
    name="kategori"
    placeholder="Kategori"
    class="form-control mb-2"
    required
  />
  <input
    type="number"
    name="stok"
    placeholder="Stok"
    class="form-control mb-2"
    required
  />
  <input
    type="number"
    name="harga"
    placeholder="Harga Barang"
    class="form-control mb-2"
    required
  />
  <input
    type="text"
    name="catatan"
    placeholder="Catatan"
    class="form-control mb-3"
    required
  />
  <button id="tombolsimpan" type="submit" class="btn btn-info">
    Tambah Barang
  </button>
</form>

<!-- DATA BARANG -->
<h5>Data Barang</h5>
<table class="table table-striped">
  <thead>
    <tr>
      <th>ID</th>
      <th>Nama</th>
      <th>Kategori</th>
      <th>Stok</th>
      <th>Harga</th>
      <th>Catatan</th>
      <th>Aksi</th>
    </tr>
  </thead>

  <tbody>
    {% for b in data.data %}
    <tr id="row-{{ b.id }}">
      <td>{{ b.id }}</td>
      <td id="name-{{ b.id }}">{{ b.nama }}</td>
      <td id="cat-{{ b.id }}">{{ b.kategori }}</td>
      <td id="stok-{{ b.id }}">{{ b.stok }}</td>
      <td id="harga-{{ b.id }}">{{ b.harga }}</td>
      <td id="catatan-{{ b.id }}">{{ b.catatan }}</td>
      <td>
        <button
          class="btn btn-sm btn-primary edit-btn"
          data-id="{{ b.id }}"
          data-nama="{{ b.nama }}"
          data-kategori="{{ b.kategori }}"
          data-stok="{{ b.stok }}"
          data-harga="{{ b.harga }}"
          data-catatan="{{ b.catatan }}"
        >
          Edit
        </button>
        <button class="btn btn-sm btn-danger delete-btn" data-id="{{ b.id }}">
          Hapus
        </button>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<!-- FORM EDIT -->
<div id="editForm" style="display: none" class="card p-3 mt-4">
  <h4 class="text-warning">Edit Data Barang</h4>

  <input
    type="text"
    id="editNama"
    class="form-control mb-2"
    placeholder="Nama Barang"
  />
  <input
    type="text"
    id="editKategori"
    class="form-control mb-2"
    placeholder="Kategori"
  />
  <input
    type="number"
    id="editStok"
    class="form-control mb-2"
    placeholder="Stok"
  />
  <input
    type="number"
    id="editHarga"
    class="form-control mb-2"
    placeholder="Harga"
  />
  <input
    type="text"
    id="editCatatan"
    class="form-control mb-3"
    placeholder="Catatan"
  />

  <button id="saveBtn" class="btn btn-success">Simpan</button>
  <button id="cancelBtn" class="btn btn-secondary">Batal</button>
</div>

<nav aria-label="Page navigation">
  <ul class="pagination justify-content-center mt-4">

    <!-- PREVIOUS -->
    <li class="page-item {% if page <= 1 %}disabled{% endif %}">
      <a class="page-link"
         href="{% if page > 1 %}{{ url_for('form_614', page=page-1, limit=10) }}{% else %}#{% endif %}">
         Previous
      </a>
    </li>

    <!-- NOMOR HALAMAN -->
    {% for p in range(1, total_pages + 1) %}
      <li class="page-item {% if p == page %}active{% endif %}">
        <a class="page-link"
           href="{{ url_for('form_614', page=p, limit=10) }}">
           {{ p }}
        </a>
      </li>
    {% endfor %}

    <!-- NEXT -->
    <li class="page-item {% if page >= total_pages %}disabled{% endif %}">
      <a class="page-link"
         href="{% if page < total_pages %}{{ url_for('form_614', page=page+1, limit=10) }}{% else %}#{% endif %}">
         Next
      </a>
    </li>

  </ul>
</nav>


<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
  $(document).ready(function () {
    const API_URL = "http://localhost:3000/barang614";

    // Simpan Button Click
    $("#tombolsimpan").click(async function (e) {
      e.preventDefault();

      const form = document.getElementById("userForm");
      const data = Object.fromEntries(new FormData(form).entries());

      try {
        const res = await fetch(API_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(data),
        });

        if (res.ok) {
          alert("‚úÖ Data berhasil disimpan!");
          location.reload();
        } else {
          alert("‚ùå Gagal menyimpan data");
        }
      } catch (error) {
        console.error("Error:", error);
        alert("‚ùå Error koneksi API");
      }
    });

    // Edit button click
    $(".edit-btn").click(function () {
      const id = $(this).data("id");
      $("#editNama").val($(this).data("nama"));
      $("#editKategori").val($(this).data("kategori"));
      $("#editStok").val($(this).data("stok"));
      $("#editHarga").val($(this).data("harga"));
      $("#editCatatan").val($(this).data("catatan"));
      $("#editForm").show();
      $("#saveBtn").data("id", id);
    });

    // Save button click
    $("#saveBtn").click(async function (e) {
      e.preventDefault();

      const id = $("#saveBtn").data("id");
      const data = {
        nama: $("#editNama").val(),
        kategori: $("#editKategori").val(),
        stok: $("#editStok").val(),
        harga: $("#editHarga").val(),
        catatan: $("#editCatatan").val(),
      };

      try {
        const res = await fetch(`${API_URL}/${id}`, {
          method: "PUT",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(data),
        });

        if (res.ok) {
          alert("‚úÖ Data berhasil dirubah!");
          location.reload();
        } else {
          alert("‚ùå Gagal menyimpan data");
        }
      } catch (error) {
        console.error("Error:", error);
        alert("‚ùå Error koneksi API");
      }
    });

    // Cancel button click
    $("#cancelBtn").click(function () {
      $("#editForm").hide();
    });

    // Delete button click
    $(".delete-btn").click(async function () {
      const id = $(this).data("id");

      if (!confirm("Yakin menghapus data ini?")) return;

      try {
        const res = await fetch(`${API_URL}/${id}`, {
          method: "DELETE",
        });

        if (res.ok) {
          alert("üóëÔ∏è Data berhasil dihapus");
          setTimeout(() => location.reload(), 500);
        } else {
          alert("‚ùå Gagal menghapus data");
        }
      } catch (err) {
        console.error(err);
        alert("‚ùå Error koneksi API");
      }
    });
  });
</script>

{% endblock %} {% block bawah7 %}
<footer class="bg-info text-white text-center py-3 mt-auto">
  <p class="mb-1 fw-bold">¬© 2025 Kelompok 7 - Atha & Jovi</p>
  <p class="mb-0">Sistem Pendataan Barang dan Pelanggan</p>
</footer>
{% endblock %}
